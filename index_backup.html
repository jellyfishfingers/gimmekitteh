<html>
    <head>
        
        <link rel="stylesheet" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    </head>

    <script>
    $(document).ready(function(){

        $.ajaxSetup({
            async: false
        });

        callKitty();
		//trafficSingapore();
        //goJBEatLokLok();
        taxisNearMe();
		
        $(".newkitty").click(function(){

            $.getJSON("https://api.thecatapi.com/v1/images/search?mime_types=gif",function(data){
                   console.log(data);
                   var caturl = data[0].url; 
            
                   $(".kittypic").html("<img src='" + caturl + "' width='100%'>");
            });

        });

        function callKitty() {
        $.getJSON("https://api.thecatapi.com/v1/images/search?mime_types=gif",function(data){
                   console.log(data);
                   var caturl = data[0].url; 
            
                   $(".kittypic").html("<img src='" + caturl + "' width='100%'>");
            });
        }

		
		function trafficSingapore() { 
		
            var groupOfImages = [];
			
            //Get 24 Hours of traffic data.
            for (var i=0; i<24; i++){
			
                //URI Of API
                var getTrafficImageURI = "https://api.data.gov.sg/v1/transport/traffic-images";
            
                //Get Time
                var time = i.toString().length == 2 ? i.toString() : "0"+ i;
                console.log("Time: " + time);

                var requestUrl = getTrafficImageURI + "?date_time=2019-08-08T" + time + "%3A00%3A00";
                   
                    
                $.getJSON(requestUrl , function(data) { 
                    console.log("Singapore");
                    console.log(data.items[0].cameras[12].camera_id);
                    
                    var image = "";
                    
                    $.each(data.items[0].cameras, function (key,value){
                            //Get only Camera 2701's Data: Causeway Camera.
                            if (data.items[0].cameras[key].camera_id === "2701"){
                                image = data.items[0].cameras[key].image;
                                groupOfImages[i] = image;
                                $(".woodlandscheckpoint").append("<br><br><p>" + time + ":00</p><img src='" + image + "' width='100%'>");
                            }
                        
                        });
                    });
            }

		}


        function goJBEatLokLok() { 
		        
            //URI Of API
            var getTrafficImageURI = "https://api.data.gov.sg/v1/transport/traffic-images";
        
            var requestUrl = getTrafficImageURI;
                
            $.getJSON(requestUrl , function(data) { 
                console.log("Singapore");
                console.log(data.items[0].cameras[12].camera_id);
                
                var image = "";
                
                $.each(data.items[0].cameras, function (key,value){
                        //Get only Camera 2701's Data: Causeway Camera.
                        if (data.items[0].cameras[key].camera_id === "2701"){
                            image = data.items[0].cameras[key].image;
                          
                            $(".goJBEatLokLok").append("<img src='" + image + "' width='100%'>");
                        }    
                });

            });
        

        }


        function taxisNearMe(){
            //Data Set: https://data.gov.sg/dataset/taxi-availability
            //Harversine Formula: https://stackoverflow.com/questions/27928/calculate-distance-between-two-latitude-longitude-points-haversine-formula
            //GPS Coordinates: https://gps-coordinates.org/ 
            
            //URI Of API
            var getTaxiAvailabilityURI = "https://api.data.gov.sg/v1/transport/taxi-availability";
        
            var requestUrl = getTaxiAvailabilityURI;

            var countTaxis = 0;
            var countTotalTaxis = 0;

            var currentLongtitude = $(".currentLongtitude").html();
            var currentLatitude = $(".currentLatitude").html();
            
            $.getJSON(requestUrl , function(data) { 
                console.log("Singapore");
            
                var image = "";

    



                $.each(data.features[0].geometry.coordinates, function (key,value){

                    
                   

                    var longtitudeLatitude  = data.features[0].geometry.coordinates[key];
                    var long = longtitudeLatitude[0];
                    var lat = longtitudeLatitude[1]; 

                    if (getDistanceFromLatLonInKm(long,lat,currentLongtitude,currentLatitude) <= 2){
                        //alert("Taxi Found!");
                        //$(".allTrafficInfo").append("<p>" + data.features[0].geometry.coordinates[key]+"</p>");
                        countTaxis++
                    } 

                    countTotalTaxis++;



                });

               
            
               

            });

            $(".countTaxis").html(countTaxis);
            $(".totalTaxis").html(countTotalTaxis);


        }


        function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
            var R = 6371; // Radius of the earth in km
            var dLat = deg2rad(lat2-lat1);  // deg2rad below
            var dLon = deg2rad(lon2-lon1); 
            var a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2)
                ; 
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
            var d = R * c; // Distance in km
            return d;
        }

        function deg2rad(deg) {
        return deg * (Math.PI/180)
        }


        


		
    });

  
    
    
    </script>

    <body>

        <center>
        <div class="header">
            <!-- <img src="sms-message.png" width="50px" height="50px"> -->
            <img src="cat.png" width="50px" height="50px">
            <h1>Gimme Kitty</h1>
        </div>
    
        <button class="newkitty">Click for new kitteh</button>
</center>
    <div class="kittypic">



    </div>

<center>

        <p>Built by <a href="mailto:lian.jiayuan@gmail.com">Lian Jiayuan</a></p>
    <p>Kitteh Pics from <a href="https://thecatapi.com">theCatAPI</a></p>
	

		
</center>










    <!-- <div>
        <div class="boxes">
            <div>Voice</div>
            <div></div>
        </div>

        <div class="boxes">
            <div class="header">
                <h1>Digital Platform</h1>
            </div>
            <div class="content">
                

            </div>
        </div>

        <div class="boxes">
            <div></div>
            <div></div>

        </div>
    </div> -->

</body>

</html>